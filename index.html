<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chess Game with AI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      text-align: center;
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .board {
      display: grid;
      grid-template-columns: repeat(8, 50px);
      grid-template-rows: repeat(8, 50px);
      gap: 2px;
      margin: 20px auto;
    }

    .square {
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      background-color: #eee;
    }

    .square.dark {
      background-color: #769656;
    }

    .square.light {
      background-color: #eeeed2;
    }

    .square.highlight {
      background-color: #f6f669;
    }

    .timers {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .timer {
      font-size: 18px;
      font-weight: bold;
    }

    .controls {
      margin-top: 20px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
    }

    button:hover {
      background-color: #0056b3;
    }

    .move-history {
      margin-top: 20px;
      text-align: left;
      max-height: 100px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
    }

    .level-select {
      margin-top: 10px;
    }

    .level-select label {
      font-size: 16px;
      margin-right: 10px;
    }

    .level-select select {
      padding: 5px;
      font-size: 16px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Chess Game with AI</h1>
    <div class="timers">
      <div class="timer" id="white-timer">White: 300s</div>
      <div class="timer" id="black-timer">Black: 300s</div>
    </div>
    <div class="board" id="board"></div>
    <div class="controls">
      <button onclick="resetGame()">Reset Game</button>
      <div class="level-select">
        <label for="ai-level">AI Level (1-15):</label>
        <select id="ai-level">
          <option value="1">1 (Easiest)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
          <option value="13">13</option>
          <option value="14">14</option>
          <option value="15">15 (Grandmaster)</option>
        </select>
      </div>
    </div>
    <div class="move-history">
      <h3>Move History</h3>
      <ul id="move-history"></ul>
    </div>
  </div>

  <!-- Stockfish.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/stockfish.js@0.1.0/stockfish.js"></script>
  <script>
    const boardElement = document.getElementById('board');
    const whiteTimerElement = document.getElementById('white-timer');
    const blackTimerElement = document.getElementById('black-timer');
    const moveHistoryElement = document.getElementById('move-history');
    const aiLevelSelect = document.getElementById('ai-level');

    let board = null;
    let currentPlayer = 'white';
    let whiteTime = 300;
    let blackTime = 300;
    let timerInterval;
    let moveHistory = [];
    let stockfish = new Worker('https://cdn.jsdelivr.net/npm/stockfish.js@0.1.0/stockfish.wasm.js');
    let game = new Chess();

    // Initialize the board
    function initBoard() {
      boardElement.innerHTML = '';
      for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
          const square = document.createElement('div');
          square.classList.add('square');
          square.classList.add((row + col) % 2 === 0 ? 'light' : 'dark');
          square.dataset.row = row;
          square.dataset.col = col;
          square.addEventListener('click', () => handleSquareClick(row, col));
          boardElement.appendChild(square);
        }
      }
      updateBoard();
    }

    // Update the board with pieces
    function updateBoard() {
      for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
          const square = document.querySelector(`.square[data-row="${row}"][data-col="${col}"]`);
          const piece = game.get([row, col]);
          square.textContent = piece ? piece.toUpperCase() : '';
        }
      }
    }

    // Handle square click
    function handleSquareClick(row, col) {
      if (currentPlayer === 'black') return; // AI's turn
      const move = game.move({ from: [row, col], to: [row, col] }); // Placeholder logic
      if (move) {
        moveHistory.push(`${currentPlayer} moved from ${move.from} to ${move.to}`);
        updateMoveHistory();
        switchPlayer();
        makeAIMove();
      }
    }

    // Make AI move
    function makeAIMove() {
      const level = parseInt(aiLevelSelect.value);
      stockfish.postMessage(`setoption name Skill Level value ${level}`);
      stockfish.postMessage('position fen ' + game.fen());
      stockfish.postMessage('go depth 10');

      stockfish.onmessage = (event) => {
        const message = event.data;
        if (message.startsWith('bestmove')) {
          const move = message.split(' ')[1];
          game.move(move);
          moveHistory.push(`AI moved ${move}`);
          updateMoveHistory();
          updateBoard();
          switchPlayer();
        }
      };
    }

    // Switch player
    function switchPlayer() {
      currentPlayer = currentPlayer === 'white' ? 'black' : 'white';
      startTimer();
    }

    // Start timer
    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (currentPlayer === 'white') {
          whiteTime--;
          whiteTimerElement.textContent = `White: ${whiteTime}s`;
        } else {
          blackTime--;
          blackTimerElement.textContent = `Black: ${blackTime}s`;
        }
        if (whiteTime <= 0 || blackTime <= 0) {
          endGame();
        }
      }, 1000);
    }

    // End game
    function endGame() {
      clearInterval(timerInterval);
      alert(`Game over! ${currentPlayer === 'white' ? 'Black' : 'White'} wins!`);
    }

    // Update move history
    function updateMoveHistory() {
      moveHistoryElement.innerHTML = moveHistory.map(move => `<li>${move}</li>`).join('');
    }

    // Reset game
    function resetGame() {
      clearInterval(timerInterval);
      whiteTime = 300;
      blackTime = 300;
      currentPlayer = 'white';
      whiteTimerElement.textContent = `White: ${whiteTime}s`;
      blackTimerElement.textContent = `Black: ${blackTime}s`;
      moveHistory = [];
      updateMoveHistory();
      game.reset();
      initBoard();
    }

    // Initialize the game
    initBoard();
  </script>
</body>
</html>
