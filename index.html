<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess vs AI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #f0f0f0;
        }
        #game-container {
            text-align: center;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        #chessboard {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 2px solid #333;
            margin: 20px auto;
        }
        .square {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            cursor: pointer;
        }
        .light {
            background: #f0d9b5;
        }
        .dark {
            background: #b58863;
        }
        .selected {
            background: #ffff99 !important;
        }
        .valid-move {
            background: #99ff99 !important;
        }
        #status {
            font-size: 18px;
            margin-top: 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Chess vs AI</h1>
        <div id="chessboard"></div>
        <div id="status"></div>
        <button onclick="restartGame()">Restart Game</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/stockfish@15.1.0/stockfish.js"></script>
    <script>
        const boardElement = document.getElementById('chessboard');
        const statusElement = document.getElementById('status');
        const chess = new Chess();
        const stockfish = new Worker('https://unpkg.com/stockfish@15.1.0/stockfish.js');
        let selectedSquare = null;
        let validMoves = [];

        // Set AI difficulty (skill level 0-20, 20 being the strongest)
        const aiSkillLevel = 10; // Adjust between 0 and 20

        // Initialize board
        function initializeBoard() {
            boardElement.innerHTML = '';
            const board = chess.board();
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    const piece = board[row][col];
                    if (piece) {
                        square.innerHTML = getPieceSymbol(piece);
                    }
                    square.onclick = () => handleSquareClick(row, col);
                    boardElement.appendChild(square);
                }
            }
            updateStatus();
        }

        // Get piece symbol
        function getPieceSymbol(piece) {
            const symbols = {
                'p': '♟', 'r': '♜', 'n': '♞', 'b': '♝', 'q': '♛', 'k': '♚',
                'P': '♙', 'R': '♖', 'N': '♘', 'B': '♗', 'Q': '♕', 'K': '♔'
            };
            return symbols[piece.type.toUpperCase()];
        }

        // Handle square click
        function handleSquareClick(row, col) {
            if (chess.turn() !== 'w') return; // Only allow moves on White's turn

            const square = chess.SQUARES[toAlgebraic(row, col)];
            if (selectedSquare) {
                const move = chess.move({ from: selectedSquare, to: square, promotion: 'q' });
                if (move) {
                    initializeBoard();
                    if (!chess.game_over()) {
                        setTimeout(aiMove, 500);
                    }
                } else {
                    clearSelection();
                    selectSquare(row, col);
                }
            } else {
                selectSquare(row, col);
            }
        }

        // Select square
        function selectSquare(row, col) {
            const square = toAlgebraic(row, col);
            const piece = chess.get(square);
            if (piece && piece.color === 'w') {
                selectedSquare = square;
                validMoves = chess.moves({ square, verbose: true }).map(m => m.to);
                highlightSquares();
            }
        }

        // Clear selection
        function clearSelection() {
            selectedSquare = null;
            validMoves = [];
            initializeBoard();
        }

        // Highlight selected and valid move squares
        function highlightSquares() {
            const squares = document.querySelectorAll('.square');
            squares.forEach(square => {
                const row = parseInt(square.dataset.row);
                const col = parseInt(square.dataset.col);
                const alg = toAlgebraic(row, col);
                if (alg === selectedSquare) {
                    square.classList.add('selected');
                } else if (validMoves.includes(alg)) {
                    square.classList.add('valid-move');
                }
            });
        }

        // AI Move
        function aiMove() {
            stockfish.postMessage(`position fen ${chess.fen()}`);
            stockfish.postMessage(`go depth ${aiSkillLevel}`);
            stockfish.onmessage = function(event) {
                const message = event.data;
                if (message.startsWith('bestmove')) {
                    const bestMove = message.split(' ')[1];
                    chess.move(bestMove);
                    initializeBoard();
                }
            };
        }

        // Update game status
        function updateStatus() {
            let status = '';
            if (chess.in_checkmate()) {
                status = 'Checkmate! ' + (chess.turn() === 'w' ? 'Black' : 'White') + ' wins!';
            } else if (chess.in_draw()) {
                status = 'Draw!';
            } else if (chess.in_check()) {
                status = 'Check! ' + (chess.turn() === 'w' ? 'White' : 'Black') + '\'s turn';
            } else {
                status = (chess.turn() === 'w' ? 'White' : 'Black') + '\'s turn';
            }
            statusElement.textContent = status;
        }

        // Convert row/col to algebraic notation
        function toAlgebraic(row, col) {
            const files = 'abcdefgh';
            return files[col] + (8 - row);
        }

        // Restart game
        function restartGame() {
            chess.reset();
            initializeBoard();
        }

        // Initialize game
        initializeBoard();
    </script>
</body>
</html>
